const defaultTheme={bgMain:getComputedStyle(document.documentElement).getPropertyValue('--bg-main').trim(),bgGradientStart:getComputedStyle(document.documentElement).getPropertyValue('--bg-gradient-start').trim(),bgGradientEnd:getComputedStyle(document.documentElement).getPropertyValue('--bg-gradient-end').trim(),bgPanel:getComputedStyle(document.documentElement).getPropertyValue('--bg-panel').trim(),bgSidebar:getComputedStyle(document.documentElement).getPropertyValue('--bg-sidebar').trim(),bgHover:getComputedStyle(document.documentElement).getPropertyValue('--bg-hover').trim(),accent:getComputedStyle(document.documentElement).getPropertyValue('--accent').trim(),accentAlt:getComputedStyle(document.documentElement).getPropertyValue('--accent-alt').trim(),textMain:getComputedStyle(document.documentElement).getPropertyValue('--text-main').trim(),textMuted:getComputedStyle(document.documentElement).getPropertyValue('--text-muted').trim(),textSubtle:getComputedStyle(document.documentElement).getPropertyValue('--text-subtle').trim(),borderSoft:getComputedStyle(document.documentElement).getPropertyValue('--border-soft').trim()};
const darkTheme={bgMain:'#111111',bgGradientStart:'#0F0F0F',bgGradientEnd:'#1C1C1C',bgPanel:'#1A1A1A',bgSidebar:'#1E1E1E',bgHover:'#2A2A2A',accent:'#9B5DE5',accentAlt:'#F15BB5',textMain:'#EEE',textMuted:'#CCC',textSubtle:'#BBB',borderSoft:'#333'};
const lightTheme={bgMain:'#FFFFFF',bgGradientStart:'#F0F0F0',bgGradientEnd:'#E0E0E0',bgPanel:'#FFFFFF',bgSidebar:'#F8F8F8',bgHover:'#E5E5E5',accent:'#5D5DE5',accentAlt:'#F1BB55',textMain:'#111111',textMuted:'#333333',textSubtle:'#555555',borderSoft:'#DDD'};
function applyTheme(theme){for(const [k,v] of Object.entries(theme)){document.documentElement.style.setProperty('--'+k.replace(/[A-Z]/g,m=>'-'+m.toLowerCase()),v);}}
const themes=['default','dark','light'];
const icons=['ðŸ“š','ðŸŒ™','â˜€ï¸'];
let themeState=0;
const themeContainer=document.createElement('div');
themeContainer.style.position='fixed';
themeContainer.style.top = '10px';
themeContainer.style.right = '10px';
themeContainer.style.left = 'auto';
themeContainer.style.display='flex';
themeContainer.style.flexDirection='column';
themeContainer.style.gap='10px';
themeContainer.style.zIndex='9999';
const themeButtons=themes.map((t,i)=>{const btn=document.createElement('button');btn.className='theme-btn';btn.innerText=icons[i];btn.style.background=i===themeState?'var(--accent)':'var(--bg-panel)';btn.style.color=i===themeState?'#fff':'var(--text-muted)';btn.addEventListener('click',()=>{themeState=i;applySelectedTheme();});themeContainer.appendChild(btn);return btn;});
document.body.appendChild(themeContainer);
function applySelectedTheme(){themeButtons.forEach((b,i)=>{b.style.background=i===themeState?'var(--accent)':'var(--bg-panel)';b.style.color=i===themeState?'#fff':'var(--text-muted)';});if(themeState===0)applyTheme(defaultTheme);else if(themeState===1)applyTheme(darkTheme);else applyTheme(lightTheme);}
function buildMenu(obj,parentPath='',isSubmenu=true,depth=0){const ul=document.createElement('ul');if(isSubmenu){ul.classList.add('submenu');ul.style.setProperty('--depth',depth);}for(const [k,v] of Object.entries(obj)){const li=document.createElement('li');if(v&&typeof v==='object'){const btn=document.createElement('button');btn.className='dropdown-toggle';btn.textContent=`${k} â–¾`;btn.style.paddingLeft=`${depth*1.25}em`;li.appendChild(btn);li.appendChild(buildMenu(v,parentPath+k+'/',true,depth+1));}else{const a=document.createElement('a');if(k.endsWith('.html')){a.href='root/'+parentPath+k;a.textContent=k;a.style.paddingLeft=`${depth*1.25}em`; }else{a.href=`#${(parentPath+k).replace(/[./]/g,'_')}`;a.textContent=k;a.style.paddingLeft=`${depth*1.25}em`; } li.appendChild(a);}ul.appendChild(li);}return ul;}
function buildSidebarMenu(manifest){if(!manifest){document.querySelector('.content').innerHTML=`<h1>Erreur</h1><p>Manifest introuvable ou invalide.</p>`;return;}const menuRoot=document.getElementById('sidebar-menu');menuRoot.innerHTML=`<li><a href="#intro">Introduction</a></li>`;menuRoot.appendChild(buildMenu(manifest,'',false,0));menuRoot.innerHTML+=`<li><a href="#license">License</a></li>`;document.querySelectorAll('.dropdown-toggle').forEach(btn=>{btn.addEventListener('click',e=>{e.preventDefault();const submenu=btn.nextElementSibling;submenu.classList.toggle('visible');btn.classList.toggle('active');});});document.querySelectorAll('.copy-btn').forEach(btn=>{btn.addEventListener('click',()=>{const code=btn.nextElementSibling.innerText;navigator.clipboard.writeText(code).then(()=>{btn.classList.add('copied');btn.innerText='âœ…';setTimeout(()=>{btn.classList.remove('copied');btn.innerText='ðŸ“‹';},1500);});});});document.querySelectorAll('.sidebar a').forEach(link=>{link.addEventListener('click',()=>{document.querySelectorAll('.sidebar a').forEach(l=>l.classList.remove('active'));link.classList.add('active');});});}
document.addEventListener('DOMContentLoaded',()=>{buildSidebarMenu(manifest)});
